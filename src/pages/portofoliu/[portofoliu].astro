---
import Layout from '../../layouts/Layout.astro'

import { readdir } from 'fs/promises'
import path from 'path'

export async function getStaticPaths() {
	const getDirectories = async (source) =>
		(await readdir(source, { withFileTypes: true }))
			.filter((dirent) => dirent.isDirectory())
			.map((dirent) => dirent.name)
	let relativePath = './src/poze-site/portofoliu'
	let absolutePath = path.resolve(relativePath)
	let directories = await getDirectories(absolutePath)
	let paths = directories.map((directory) => ({
		params: { portofoliu: directory },
		props: { name: directory }
	}))
	return paths
}

const { portofoliu } = Astro.params
const { name } = Astro.props

const allImgs = await Astro.glob('../../poze-site/portofoliu/**/*')

const filteredImgs = allImgs.filter((img) => {
	return img.default.src.includes(name)
})
---

<Layout title={`Paul Clapa | Portofoliu - ${name}`}>
	<!-- {
		filteredImgs.map((cacuta) => {
			return <img src={cacuta.default.src} alt={cacuta.url} />
		})
	} -->
</Layout>
